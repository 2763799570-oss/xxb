<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨€çµæ¸¸æˆè¿›åº¦æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #5a6fd8;
        }
        .progress-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .battle-result {
            display: inline-block;
            margin: 5px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ® è¨€çµæ¸¸æˆè¿›åº¦ä¿å­˜æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š å½“å‰ç”¨æˆ·çŠ¶æ€</h3>
            <div id="userStatus">æ£€æŸ¥ä¸­...</div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ æ¨¡æ‹Ÿæˆ˜æ–—ç»“æœ</h3>
            <button class="test-button" onclick="simulateBattle('wordBattle', 95, true)">å•è¯æˆ˜æ–— Sçº§</button>
            <button class="test-button" onclick="simulateBattle('grammarBattle', 85, true)">è¯­æ³•æˆ˜æ–— Açº§</button>
            <button class="test-button" onclick="simulateBattle('readingBattle', 75, false)">é˜…è¯»æˆ˜æ–— Bçº§</button>
            <button class="test-button" onclick="simulateBattle('wordBattle', 65, false)">å•è¯æˆ˜æ–— Cçº§</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ˆ å½“å‰è¿›åº¦</h3>
            <div id="progressDisplay" class="progress-display">
                <div>æ€»è¿›åº¦: <span id="totalProgress">0%</span></div>
                <div class="battle-result">
                    å•è¯æˆ˜æ–—: åˆ†æ•° <span id="wordScore">0</span>, å°è¯• <span id="wordAttempts">0</span>, å®Œæˆ <span id="wordCompleted">å¦</span>
                </div>
                <div class="battle-result">
                    è¯­æ³•æˆ˜æ–—: åˆ†æ•° <span id="grammarScore">0</span>, å°è¯• <span id="grammarAttempts">0</span>, å®Œæˆ <span id="grammarCompleted">å¦</span>
                </div>
                <div class="battle-result">
                    é˜…è¯»æˆ˜æ–—: åˆ†æ•° <span id="readingScore">0</span>, å°è¯• <span id="readingAttempts">0</span>, å®Œæˆ <span id="readingCompleted">å¦</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”„ æµ‹è¯•æ“ä½œ</h3>
            <button class="test-button" onclick="refreshProgress()">åˆ·æ–°è¿›åº¦</button>
            <button class="test-button" onclick="resetProgress()">é‡ç½®è¿›åº¦</button>
            <button class="test-button" onclick="exportProgress()">å¯¼å‡ºè¿›åº¦</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
            <div id="testLog" style="background: #f8f9fa; padding: 10px; border-radius: 5px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
        </div>
    </div>

    <script src="js/userDataManager.js"></script>
    <script>
        let testLog = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testLog.push(`[${timestamp}] ${message}`);
            document.getElementById('testLog').innerHTML = testLog.join('<br>');
            document.getElementById('testLog').scrollTop = document.getElementById('testLog').scrollHeight;
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•...');
            checkUserStatus();
            refreshProgress();
        });
        
        function checkUserStatus() {
            if (window.userDataManager) {
                if (window.userDataManager.isLoggedIn()) {
                    const user = window.userDataManager.getCurrentUser();
                    document.getElementById('userStatus').innerHTML = `âœ… å·²ç™»å½•: ${user.username}`;
                    log(`ç”¨æˆ·å·²ç™»å½•: ${user.username}`);
                } else {
                    document.getElementById('userStatus').innerHTML = 'âŒ æœªç™»å½•';
                    log('ç”¨æˆ·æœªç™»å½•');
                }
            } else {
                document.getElementById('userStatus').innerHTML = 'âŒ userDataManager æœªåŠ è½½';
                log('userDataManager æœªåŠ è½½');
            }
        }
        
        function simulateBattle(battleType, score, completed) {
            if (!window.userDataManager || !window.userDataManager.isLoggedIn()) {
                log('é”™è¯¯: ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•ä¿å­˜è¿›åº¦');
                return;
            }
            
            window.userDataManager.updateKotodamaProgress(battleType, score, completed);
            log(`æ¨¡æ‹Ÿæˆ˜æ–—: ${battleType}, åˆ†æ•°: ${score}, å®Œæˆ: ${completed}`);
            refreshProgress();
        }
        
        function refreshProgress() {
            if (!window.userDataManager || !window.userDataManager.isLoggedIn()) {
                log('æ— æ³•åˆ·æ–°è¿›åº¦: ç”¨æˆ·æœªç™»å½•');
                return;
            }
            
            const userStats = window.userDataManager.getUserStatsSummary();
            if (userStats && userStats.kotodamaProgress) {
                const progress = userStats.kotodamaProgress;
                
                document.getElementById('totalProgress').textContent = progress.totalProgress + '%';
                
                document.getElementById('wordScore').textContent = progress.wordBattle.score;
                document.getElementById('wordAttempts').textContent = progress.wordBattle.attempts;
                document.getElementById('wordCompleted').textContent = progress.wordBattle.completed ? 'æ˜¯' : 'å¦';
                
                document.getElementById('grammarScore').textContent = progress.grammarBattle.score;
                document.getElementById('grammarAttempts').textContent = progress.grammarBattle.attempts;
                document.getElementById('grammarCompleted').textContent = progress.grammarBattle.completed ? 'æ˜¯' : 'å¦';
                
                document.getElementById('readingScore').textContent = progress.readingBattle.score;
                document.getElementById('readingAttempts').textContent = progress.readingBattle.attempts;
                document.getElementById('readingCompleted').textContent = progress.readingBattle.completed ? 'æ˜¯' : 'å¦';
                
                log('è¿›åº¦å·²åˆ·æ–°');
            } else {
                log('æ— æ³•è·å–è¿›åº¦æ•°æ®');
            }
        }
        
        function resetProgress() {
            if (!window.userDataManager || !window.userDataManager.isLoggedIn()) {
                log('é”™è¯¯: ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•é‡ç½®è¿›åº¦');
                return;
            }
            
            const user = window.userDataManager.getCurrentUser();
            user.profile.kotodamaProgress = {
                wordBattle: { completed: false, score: 0, attempts: 0 },
                grammarBattle: { completed: false, score: 0, attempts: 0 },
                readingBattle: { completed: false, score: 0, attempts: 0 },
                totalProgress: 0
            };
            
            window.userDataManager.saveCurrentUser();
            window.userDataManager.saveUser(user);
            
            log('è¿›åº¦å·²é‡ç½®');
            refreshProgress();
        }
        
        function exportProgress() {
            if (!window.userDataManager || !window.userDataManager.isLoggedIn()) {
                log('é”™è¯¯: ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•å¯¼å‡ºè¿›åº¦');
                return;
            }
            
            const userStats = window.userDataManager.getUserStatsSummary();
            if (userStats && userStats.kotodamaProgress) {
                const progressData = JSON.stringify(userStats.kotodamaProgress, null, 2);
                log('è¿›åº¦æ•°æ®å¯¼å‡º:');
                log(progressData);
            }
        }
    </script>
</body>
</html>
